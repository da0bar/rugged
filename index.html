<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUGGED</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"
    type="application/javascript"></script>

    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.ico">
</head>

<body>
    <div id="notificationBanner" class="hidden">
        <p id="notificationMessage"></p>
    </div>
    <div id="transactionDetails" class="hidden"></div>
    <div class="container">
        <h1>RUGGED</h1>
        <button class="connect-wallet-btn" id="connectWallet">
            <div>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3" />
              </svg>              
            </div>                       
            <span>Connect Wallet</span>
        </button>        
        <label for="betValue">Bet Number (0-100):</label>
        <input id="betValue" type="number" min="0" max="100" placeholder="Enter your number" required>
        <label for="betAmount">Bet Amount (ETH):</label>
        <input id="betAmount" type="text" placeholder="0.01" required>
        <button type="button" class="button place-bet-btn" id="placeBet">Place Bet</button>
        <button type="button" class="button withdraw-btn" id="withdraw">Withdraw</button>
    </div>

    <img src="resources/img/logog.png" id="im1" class="bouncing-image" style="animation-delay: 0s;">
    <img src="resources/img/rugged.png" id="im2" class="bouncing-image" style="animation-delay: 1s;">
    <img src="resources/img/aperug.png" id="im3" class="bouncing-image" style="animation-delay: 2s;">

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const betValueParam = urlParams.get('betValue');
        const betAmountParam = urlParams.get('betAmount');

      
        betValueParam && (document.getElementById('betValue').value = betValueParam);
        betAmountParam && (document.getElementById('betAmount').value = betAmountParam);
        

        let provider;
        let signer;
        let contract;
        let account;
        const connectWalletButton = document.getElementById("connectWallet");

        const CONTRACT_ADDRESS = '0x18d12A69A6940dD4902eCEcac5003deAfF8FcB89'
        const CONTRACT_ABI = [{ "inputs": [], "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "player", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }, { "indexed": false, "internalType": "uint8", "name": "betNumber", "type": "uint8" }], "name": "BetPlaced", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "uint8", "name": "winningNumber", "type": "uint8" }, { "indexed": false, "internalType": "address[]", "name": "winners", "type": "address[]" }, { "indexed": false, "internalType": "uint256", "name": "rewardPerWinner", "type": "uint256" }], "name": "RoundEnded", "type": "event" }, { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "bets", "outputs": [{ "internalType": "address", "name": "player", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }, { "internalType": "uint8", "name": "betNumber", "type": "uint8" }, { "internalType": "bool", "name": "inGame", "type": "bool" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "calculatePot", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint8", "name": "_winningNumber", "type": "uint8" }], "name": "endRound", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "getInGamePlayers", "outputs": [{ "internalType": "address[]", "name": "", "type": "address[]" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "owner", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint8", "name": "_betNumber", "type": "uint8" }], "name": "placeBet", "outputs": [], "stateMutability": "payable", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "winners", "outputs": [{ "internalType": "address", "name": "player", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "_address", "type": "address" }], "name": "withdraw", "outputs": [], "stateMutability": "nonpayable", "type": "function" }];
        const showNotification = (message, duration = 3000, style = "success") => {
            const banner = document.getElementById('notificationBanner');

            if (!banner) {
                console.error("Notification banner element not found!");
                return;
            }
            banner.className = ""; 
            banner.classList.add("show");
            banner.classList.add(style); 

            banner.querySelector("#notificationMessage").textContent = message;

            setTimeout(() => {
                banner.classList.remove('show');
            }, duration);
        };
        const showTransactionHash = (txHash) => {
            const txSection = document.getElementById("transactionDetails");

            if (!txSection) {
                console.error("Transaction details section not found!");
                return;
            }

            txSection.innerHTML = `Transaction Hash: 
            <a href="https://sepolia.basescan.org/tx/${txHash}" target="_blank" rel="noopener noreferrer" style="color: #4caf50; text-decoration: none;">
                ${txHash}
            </a>`;
            txSection.classList.add("visible"); 
        };
        connectWalletButton.addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    provider = new ethers.providers.Web3Provider(window.ethereum, "any");
                    const accounts = await provider.send("eth_requestAccounts", []); 
                    account = accounts[0]
                    signer = provider.getSigner();
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    showNotification("Wallet connected!", 3000, "success");
                    connectWalletButton.innerHTML = `
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3" />
                        </svg>
                    </div>
                    <span>${account.slice(0, 6)}...${account.slice(-4)}</span>
                `;
                connectWalletButton.classList.add("connected");
              
                } catch (error) {
                    console.error("Error connecting wallet:", error);
                    showNotification("Failed to connect wallet. Try again cuck.", 3000, "error");
                }
            } else {
                showNotification("MetaMask not detected! Install MetaMask to use this.", 3000, "error");
            }
        });
        document.getElementById('placeBet').addEventListener('click', async () => {
            const betValue = document.getElementById('betValue').value;
            const betAmount = document.getElementById('betAmount').value;

          
            if (!signer || !contract) {
                showNotification("Connect you wallet first cuck.", 3000, "error");
                return;
            }
            if(!betValue || !betAmount) {
                showNotification("You have to bet something chad", 3000, "error");
                return;
            }

            try {
                const tx = await contract.placeBet(Number(betValue), {
                    value: ethers.utils.parseEther(betAmount),
                });
                showNotification("Transaction sent, waiting for confirmation...", 3000, "success");
                await tx.wait();
                showNotification("Bet placed successfully! Return to the bot", 5000, "success");
                showTransactionHash(tx.hash);
                
            } catch (error) {
                console.error("Error placing bet:", error);
                showNotification("Failed to place bet", 3000, "error");
            }
        });

        document.getElementById("withdraw").addEventListener("click", async () => {
            try {
                if (!signer || !contract) {
                showNotification("Connect you wallet first cuck.", 3000, "error");
                return;
            }
                const tx = await contract.withdraw(account);
                await tx.wait();
                showNotification("Enjoy your money chad", 3000, "success");
            } catch (err) {
                console.error(err);
                showNotification("Nothing to withdraw cuck", 3000, "error");
            }
        });
    </script>
</body>

</html>